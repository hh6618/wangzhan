<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>我的简单网站</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>欢迎来到我的网站！</h1>
  <p>这是一个简单的HTML页面。</p>

  <div class="post-section">
      <h2>发布新文章/公告</h2>
      <form id="postForm">
          <input type="text" id="postTitle" placeholder="文章标题" required>
          <textarea id="postContent" placeholder="文章内容" required></textarea>
          <button type="submit">发布</button>
      </form>
  </div>

  <div class="posts-display">
      <h2>最新文章/公告</h2>
      <div id="postsContainer">
          </div>
  </div>

  <script>
    // Supabase 初始化
    // 确保 'https://ucztckxladpgbzjvcwck.supabase.co' 和 'eyJhbGciOiJIUzI1Ni...' 是纯净的字符串，没有空格或换行
    const supabaseClient = supabase.createClient(
      'https://ucztckxladpgbzjvcwck.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjenRja3hsYWRwZ2J6anZjd2NrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTkxNTcsImV4cCI6MjA2ODQ5NTE1N30.kLa03Hgd33_roU_B3-wSVKwjeaJLxwddu4_v_Y05RBw'
    );

    const form = document.getElementById('postForm');
    const container = document.getElementById('postsContainer');

    // 页面加载时读取文章
    async function loadPosts() {
      const { data, error } = await supabaseClient
        .from('posts')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) {
        container.innerHTML = '<p>加载文章失败：' + error.message + '</p>';
        console.error("Error loading posts:", error); // 打印详细错误到控制台
        return;
      }
      container.innerHTML = '';
      data.forEach(p => {
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `<h3>${p.title}</h3><p>${p.content}</p>`;
        container.appendChild(div);
      });
    }

    // 发布文章
    form.addEventListener('submit', async e => {
      e.preventDefault();
      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;
      const { error } = await supabaseClient.from('posts').insert({ title, content });
      if (error) {
        alert('发布文章失败：' + error.message);
        console.error("Error posting article:", error); // 打印详细错误到控制台
        return;
      }
      form.reset();
      loadPosts(); // 发布成功后重新加载文章列表
    });

    // 页面加载完成后立即执行
    loadPosts();
  </script>
</body>
</html>